<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Car Price Estimator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h3 class="mb-4">Car Price Estimator</h3>

    <form id="form" method="post" action="/predict">
      
      <div class="mb-3">
        <label>Manufacturer</label>
        <select name="manufacturer" class="form-select">
          {% for m in manufacturers %}
            <option value="{{ m }}">{{ m|capitalize }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label>KMS Driven (km)</label>
        <input name="kms_driven" type="number" class="form-control" value="50000">
      </div>

      <div class="mb-3">
        <label>Fuel</label>
        <select name="fuel" class="form-select">
          {% for f in fuels %}
            <option value="{{ f }}">{{ f|capitalize }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label>Car Age (years)</label>
        <input name="car_age" type="number" class="form-control" value="5">
      </div>

      <button type="submit" class="btn btn-primary">Estimate (Form)</button>
      <button id="ajaxBtn" type="button" class="btn btn-outline-primary">Estimate (AJAX)</button>

    </form>

    <div class="mt-4 card p-3">
      <h5>Estimated Value</h5>
      <div id="price" class="fs-3">—</div>
    </div>
  </div>

  <script>
    document.getElementById('ajaxBtn').addEventListener('click', async () => {
      const form = document.getElementById('form');
      const fd = new FormData(form);
      const obj = {};
      for (const [k, v] of fd.entries()) obj[k] = v;

      document.getElementById('price').textContent = "Predicting...";

      try {
        const resp = await fetch('/predict', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(obj)
        });

        const json = await resp.json();
        if (resp.ok) {
          document.getElementById('price').textContent =
            "₹ " + Number(json.predicted_price).toLocaleString();
        } else {
          document.getElementById('price').textContent = "Error";
        }
      } catch (err) {
        document.getElementById('price').textContent = "Error";
        console.error(err);
      }
    });
  </script>

</body>
</html>
